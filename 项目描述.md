# 区间交易系统
- 本项目主要尝试探索区间交易系统 不涉及常规的技术指标 完全基于自创的分析框架

# 峰谷算法
## HL算法
- 设置颗粒度参数g=3
- 对于K线高点H 如果满足H高于等于前后各g根K线的高点 则该高点称为摆动高点H
- 对于K线低点L 如果满足L低于等于前后各g根K线的低点 则该低点称为摆动低点L

## 峰谷算法
- 对于由HL组成的序列 如果存在两个或以上相邻的H 或者两个或以上相邻的L 则对这些相邻的连续H或L进行去重
- H去重遵循取数值最高的H 如果数值相等则取时间最早
- L去重遵循取数值最低的L 如果数值相等则取时间最早
- 去重之后形成的类似H L H L H L这样间隔交错的序列 定义为峰谷序列

## 补充说明
- HL和峰谷算法 都具有滞后性 依据g值的大小 滞后性也有所不同 在用历史K线进行回测时 尤其需要注意“当前K线”是否已经能够确认HL点或峰谷点 杜绝数据泄露

# 关键价位算法
## 观察窗口
- 取“最近的”w根K线作为观察窗口 例如w=120 w是可变的参数
- 以高低点替代开盘价和收盘价来计算ATR ATR的参数为w 这里的ATR 指的是窗口最后一根K线的ATR
- 将w根K线数据中的high和low 作为关键价位的候选点
## 吸引力得分
- 计算任一一个high或low的“吸引力” 例如对于K线n的高点 high_n 统计剩余的w-1根K线的high和low 有多少处于[high_n-0.1ATR,high_n+0.1ATR]的范围 并以非线性的方式计算得分 处于该区间范围内 越接近high_n的得分越高 得分在[0,1]之间 并统计所有满足区间范围的K线的总分 将总分/w作为high_n的吸引力得分
- 需要注意的是 high_n的吸引力得分一定是一个[0,1]之间的值 而且 如果同一根K线的high和low都满足high_n的得分区间范围 则只取数值较高的计入分数 同一根K线 只计一次分数
- 给0.1取一个参数名 未来可能需要通过调节得分区间的宽窄 来更加精准的识别关键价位
## 关键价位的筛选
- 对w根K线总计2w个high和low进行吸引力得分计算
- 设定一个阈值参数 默认为0.1
    - 筛选2w个得分中 最高两个 且要求两个均满足大于等于阈值 当前暂定为0.1 数值较高的计为key_1 较低的计为key_0
    - (key_1 - key_0)>ATR
- 满足以上条件的key_1和key_0 作为关键价位1和0
## 扩展价位
- 依据关键价位1和0 进行扩展价位计算 扩展价位-1=(key_0 - 1*(key_1 - key_0)) 扩展价位-2=(key_1 - 2*(key_1 - key_0))；同理 扩展价位2=(key_1+1*(key_1 - key_0)) 扩展价位3=(key_1+2*(key_1 - key_0))

# 关键价位和扩展价位的动态更新
- 随着新的K线生成 观察窗口向右移动 因此会生成新的关键价位和扩展价位

# 交易规则
- 采用中性挂单 在扩展价位2处挂单做空 sl=扩展价位3 TP=扩展价位-1；在扩展价位-1处挂单做多 sl=扩展价位-2 TP=扩展价位2
- 同时挂单 一个方向成交则取消另一个方向的挂单
- 由于关键价位和扩展价位会动态更新 因此挂单也跟随动态更新

# 通过回测来调整参数
- 需要构建高效的回测算法 对binance交易所排名前10的交易对至少两年的5分钟K线数据进行回测
- 并将上述的关键参数设为区间 进行参数优化 例如[high_n-0.1ATR,high_n+0.1ATR]中的0.1 可以取值[0.05,0.15] 步长为0.01；窗口取值[120,240] 步长为10
- 是否可以看成是超参数优化？？？？？？？？

# 通过参数优化之后 开始提取特征
- 特征以50个峰谷的扩展价位比例和归一化成交量作为特征
    - 扩展价位比例：(峰谷对应的高点或低点数值-key_0)/(key_1 - key_0)
- 可以预见的是 这50个峰谷 不存在明显的重要度差异 或者高辨识度等 因此需要挑选能够通过这种时序学习“分析价格走势”的算法
- 通过前期的10个交易对至少2年数据的回测 能够得到正负样本的数量和比例 根据这些数据 来决定样本的平衡处理
- 交易规则作为标签

# 预期和展望
- 预期：
    - 希望通过机器学习/深度学习 验证存在有效的模式 能够取得正期望值的交易机会
- 展望：（暂时不考虑）
    - 用训练好的模型 连接交易所 通过websecket 同时监控100-1000个交易对的形态（依据电脑性能）并且能够发出交易信号
    - 在足够长时间的验证之后 开发简单的UI 着手连接API key 实现程序交易


# 补充：
- 当前电脑已经安装 Poetry
- cursor已经安装插件：gitlens、GitHub Actions、EditorConfig for VS Code、
- cursor设置中的MCP&integration选项中已经连接上GitHub
